<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Faravonlik Maktabi - Admin Panel</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>🔑 Admin Panel</h1>

  <h2>O‘quvchi qo‘shish</h2>
  <form id="addForm">
    <input type="text" id="name" placeholder="Ism Familiya" required>
    <input type="number" id="grade" placeholder="Baho" required>
    <select id="attendance">
      <option value="Bor">Bor</option>
      <option value="Yo‘q">Yo‘q</option>
    </select>
    <button type="submit">➕ Qo‘shish</button>
  </form>

  <h2>O‘quvchilar ro‘yxati</h2>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Ism</th>
        <th>Baho</th>
        <th>Davomat</th>
        <th>Amallar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { getStudents, addStudent, updateStudent, deleteStudent } from "./firebase.js";

    // 🔹 O‘quvchi qo‘shish
    document.getElementById("addForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const grade = document.getElementById("grade").value;
      const attendance = document.getElementById("attendance").value;

      await addStudent(name, grade, attendance);
      loadStudents();
      e.target.reset();
    });

    // 🔹 Ro‘yxatni yuklash
    async function loadStudents() {
      const students = await getStudents();
      const tbody = document.querySelector("#studentsTable tbody");
      tbody.innerHTML = "";
      students.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td><input type="text" value="${s.name}" onchange="update('${s.id}', 'name', this.value)"></td>
            <td><input type="number" value="${s.grade}" onchange="update('${s.id}', 'grade', this.value)"></td>
            <td>
              <select onchange="update('${s.id}', 'attendance', this.value)">
                <option value="Bor" ${s.attendance === "Bor" ? "selected" : ""}>Bor</option>
                <option value="Yo‘q" ${s.attendance === "Yo‘q" ? "selected" : ""}>Yo‘q</option>
              </select>
            </td>
            <td><button onclick="del('${s.id}')">❌ O‘chirish</button></td>
          </tr>
        `;
      });
    }

    // 🔹 Yangilash va o‘chirish
    window.update = async (id, field, value) => {
      await updateStudent(id, { [field]: value });
    }

    window.del = async (id) => {
      await deleteStudent(id);
      loadStudents();
    }

    loadStudents();
  </script>
</body>
</html>
